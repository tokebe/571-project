---
title: "Maps"
output: html_notebook
---

## Processing UFO data

Loading in libraries

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
```

Reading in US data

```{r message=FALSE, warning=FALSE}
ufo_data_us <- read_csv('../data/ufo_data_us_cleaned_v2.csv')
```

Some cleaning

```{r}
# Converting time posted
ufo_data_us$Posted <- as.Date(ufo_data_us$Posted, format = "%m/%d/%y")

# Clean time of sighting (only saves Dates)
ufo_data_us$`Date/Time` <- as.Date(ufo_data_us$`Date/Time`, format = "%m/%d/%y %H:%M")
```

Aggregating UFO data for historical time series (wide format to match stacked D3 format)

```{r}
historical_data <- ufo_data_us %>%
  mutate(`Date/Time` = case_when(
          `Date/Time` > as.POSIXct("2021-04-01 01:00:00") ~ `Date/Time` - years(100),
          TRUE ~ `Date/Time`)
        ) %>% 
  group_by(`Date/Time`) %>% 
  summarize(
    Total = n()
  ) %>% 
  drop_na() 

# Get UFO data by state
states <- ufo_data_us %>% 
  mutate(`Date/Time` = case_when(
          `Date/Time` > as.POSIXct("2021-04-01 01:00:00") ~ `Date/Time` - years(100),
          TRUE ~ `Date/Time`)
        ) %>% 
  group_by(`Date/Time`, State) %>% 
  summarize(
    Sightings = n(),
    .groups = 'keep'
  ) %>% 
  drop_na() %>% 
  pivot_wider(names_from = State, values_from = Sightings, values_fill = list(Sightings = 0))

# Get UFO data by shape
shapes <- ufo_data_us %>% 
  mutate(`Date/Time` = case_when(
          `Date/Time` > as.POSIXct("2021-04-01 01:00:00") ~ `Date/Time` - years(100),
          TRUE ~ `Date/Time`)
        ) %>% 
  group_by(`Date/Time`, Shape) %>% 
  summarize(
    Sightings = n(),
    .groups = 'keep'
  ) %>% 
  drop_na() %>% 
  pivot_wider(names_from = Shape, values_from = Sightings, values_fill = list(Sightings = 0))

# Wide format joined
wide_joined <- inner_join(states, shapes, by = 'Date/Time')
wide_joined <- inner_join(wide_joined, historical_data, by = 'Date/Time')

# Writes csv
write_csv(wide_joined, '../webpage/data/us-historical-wide.csv')
```

